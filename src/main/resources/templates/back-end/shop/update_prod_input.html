<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>修改商品</title>


<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
	$(document).ready(function() {
		var navbarHeight = $('.navbar').outerHeight();
		var shopnavbarHeight = $('.shopnavbar').outerHeight();
		$('.sidebar').css('top', navbarHeight + shopnavbarHeight);
		$('.display').css('margin-top', navbarHeight + shopnavbarHeight + 20);
	});

	//刪除圖片
	$(document).ready(function() {
		$('.btn-danger').click(function() {
			var index = $(this).data('index');
			var prodPicNo = $(this).data('prod-pic-no');
			var picElement = $('#pic-' + index);

			$.ajax({
				url : '/shop/prodpic/deleteProductImage',
				type : 'POST',
				contentType : 'application/json',
				data : JSON.stringify({
					prodPicNo : prodPicNo
				}),
				success : function(response) {
					console.log('Response:', response);  // 调试输出
					if (response.success) {
						picElement.remove();
						alert('圖片刪除成功');
					} else {
						alert('圖片刪除失敗');
					}
				},
				error: function(jqXHR, textStatus, errorThrown) {
					console.log('Response:', response);  // 调试输出
			        console.error('Error details:', textStatus, errorThrown);  // 打印錯誤信息到控制台
			        alert('圖片刪除錯誤: ' + textStatus);  // 向用戶顯示詳細錯誤信息
			    }
			});
		});
	});
</script>

<style type="text/css">
* {
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

.navbar {
	position: fixed;
	top: 0;
	width: 100%;
	border-bottom: solid 1px #E0E0E0;
	z-index: 1000;
}

.shopnavbar {
	background-color: #90c320;
	font-size: 36px;
	font-weight: bold;
	border-bottom: solid 1px #E0E0E0;
	z-index: 999;
	position: fixed;
	top: 56px; /* 確保位於 navbar 下方 */
	width: 100%;
}

.sidebar {
	position: fixed;
	top: 112px; /* 確保位於 shopnavbar 下方 */
	bottom: 0;
	background-color: #f0f8e0;
	width: 180px;
	padding-top: 20px;
	padding-bottom: 20px; /* 確保內容不被 bottom 覆蓋 */
	color: #333;
	font-size: 16px;
	border-right: solid 1px #E0E0E0;
	overflow-y: auto; /* 確保內容過多時可以滾動 */
}

.display {
	margin-left: 200px; /* 確保內容位於 sidebar 右側 */
	margin-top: 180px; /* 確保內容位於 navbar 和 shopnavbar 下方 */
	padding: 20px;
	width: calc(100% - 200px); /* 確保內容佔滿剩餘寬度 */
	overflow-x: auto; /* 確保內容過寬時可以滾動 */
}

a img {
	border: none; /* 移除圖片邊框 */
}

a {
	text-decoration: none; /* 移除超連結的底線 */
}
</style>
</head>
<body>

	<nav th:insert="~{/back-end/shop/back_end_navbar.html}"></nav>
	<nav class="shopnavbar">
		<a th:href="@{/shop/shopManagement/select_page}"> <img id="logo"
			th:src="@{/images/TopSeeker_logo.png}" width="80px">
		</a>修改商品
	</nav>

	<div class="sidebar">
		<ul>
			<li><h5>
					<a th:href='@{/shop/shopManagement/select_page}'>查詢商品(主頁)</a>
				</h5></li>
			<li><h5>
					<a th:href='@{/shop/shopManagement/listAllProd}'>檢視所有商品</a>
				</h5></li>
			<li><h5>
					<a href='addProd'>新增商品</a>
				</h5></li>
			<li><h5>
					<a href="#">商品圖片新增/修改</a>
				</h5></li>
		</ul>
	</div>

	<div class="display">

		<form th:action="@{update}" method="post" th:object="${shopProductVO}"
			enctype="multipart/form-data">


			<div>
				<label>商品編號:</label>
				<!-- 				<input type="text" th:field="*{prodNo}" style="border: 0px; font-weight: bold;" readonly /><br /> -->
				<input class="form-control" type="text" th:field="*{prodNo}"
					disabled readonly>
			</div>


			<div class="mb-3">
				<label for="prodStatus">商品狀態:</label> <select
					th:field="*{prodStatus}" name="prodStatus" class="form-select"
					id="prodStatus">
					<option value="1" th:selected="${prodStatus} == 0">上架</option>
					<option value="0" th:selected="${prodStatus} == 1">下架</option>
				</select> <span th:if="${#fields.hasErrors('prodStatus')}"
					th:errors="*{prodStatus}" class="error" id="prodStatus.errors"></span>
			</div>

			<div class="mb-3">
				<label for="prodName" class="form-label">商品名稱:</label> <input
					type="text" th:field="*{prodName}" class="form-control"
					id="prodName" onclick="hideContent('prodName.errors');"> <span
					th:if="${#fields.hasErrors('prodName')}" th:errors="*{prodName}"
					class="error" id="prodName.errors"></span>
			</div>

			<div class="mb-3">
				<label for="prodTypeNo">商品類別:</label> <select name="prodTypeNo"
					th:field="*{shopProductTypeVO.prodTypeNo}" class="form-select"
					id="prodTypeNo">
					<option th:each="type : ${shopProdTypeListData}"
						th:value="${type.prodTypeNo}" th:text="${type.prodTypeName}">
					</option>
					<!-- 					<option value="1">包袋</option> -->
					<!-- 					<option value="2">鞋類</option> -->
					<!-- 					<option value="3">裝備配件</option> -->
					<!-- 					<option value="4">服飾</option> -->
				</select> <span th:if="${#fields.hasErrors('shopProductTypeVO.prodTypeNo')}"
					th:errors="*{shopProductTypeVO.prodTypeNo}" class="error"
					id="shopProductTypeVO.prodTypeNo.errors"></span>
			</div>

			<div class="mb-3">
				<label for="prodPrice" class="form-label">商品定價:</label> <input
					type="text" th:field="*{prodPrice}" class="form-control"
					id="prodPrice" onclick="hideContent('prodPrice.errors');">
				<span th:if="${#fields.hasErrors('prodPrice')}"
					th:errors="*{prodPrice}" class="error" id="prodPrice.errors"></span>
			</div>

			<div class="mb-3">
				<label for="prodInfo" class="form-label">商品介紹:</label>
				<textarea th:field="*{prodInfo}"
					onclick="hideContent('prodInfo.errors');" class="form-control"
					id="prodInfo" rows="10"></textarea>
				<span class="alert alert-danger" role="alert"
					th:if="${#fields.hasErrors('prodInfo')}" th:errors="*{prodInfo}"
					id="prodInfo.errors"></span>
			</div>

			<div class="mb-3">
				<label for="ProdPic" class="form-label">商品圖片:</label>
				<div id="ProdPic">
					<div th:each="pic, iterStat : ${shopProductVO.shopProductPics}"
						th:id="'pic-' + ${iterStat.index}">
						<!--測試印出產品圖片編號 -->
						<input type="text" th:value="${pic.prodPicNo}"
							class="form-control mb-2" readonly> <img
							th:src="@{/shop/DBGifReader3} + '?prodPicNo=' + ${pic.prodPicNo}"
							class="img-thumbnail mb-2" width="150" height="150">
						<!--刪除按鈕 -->
						<button type="button" class="btn btn-danger btn-sm"
							th:data-index="${iterStat.index}"
							th:data-prod-pic-no="${pic.prodPicNo}">刪除</button>
					</div>
					上傳新圖片 <label for="prodPic" class="form-label">商品圖片:</label> <input
						type="file" name="picSet" id="prodPic" class="form-control"
						multiple>
				</div>
			</div>

			<div>
				<input type="hidden" th:field="*{prodDate}" /> <span
					th:if="${#fields.hasErrors('prodDate')}" th:errors="*{prodDate}"
					class="error" id="prodDate.errors"></span>
			</div>



			<div>
				<div></div>
				<div>
					<button type="submit" class="btn btn-success" id="submit"
						name="picSet">送出修改</button>
				</div>
				<div></div>
			</div>
		</form>

	</div>



	<!-- JavaScript part -->
	<!--
<script type="text/javascript">
//清除提示信息
function hideContent(d) {
     document.getElementById(d).style.display = "none";
}

//照片上傳-預覽用
var filereader_support = typeof FileReader != 'undefined';
if (!filereader_support) {
	alert("No FileReader support");
}
acceptedTypes = {
		'image/png' : true,
		'image/jpeg' : true,
		'image/gif' : true
};
function previewImage() {
	var upfile1 = document.getElementById("upFiles");
	upfile1.addEventListener("change", function(event) {
		var files = event.target.files || event.dataTransfer.files;
		for (var i = 0; i < files.length; i++) {
			previewfile(files[i])
		}
	}, false);
}
function previewfile(file) {
	if (filereader_support === true && acceptedTypes[file.type] === true) {
		var reader = new FileReader();
		reader.onload = function(event) {
			var image = new Image();
			image.src = event.target.result;
			image.width = 100;
			image.height = 75;
			image.border = 2;
			if (blob_holder.hasChildNodes()) {
				blob_holder.removeChild(blob_holder.childNodes[0]);
			}
			blob_holder.appendChild(image);
		};
		reader.readAsDataURL(file);
		document.getElementById('submit').disabled = false;
	} else {
		blob_holder.innerHTML = "<div  style='text-align: left;'>" + "● filename: " + file.name
				+ "<br>" + "● ContentTyp: " + file.type
				+ "<br>" + "● size: " + file.size + "bytes"
				+ "<br>" + "● 上傳ContentType限制: <b> <font color=red>image/png、image/jpeg、image/gif </font></b></div>";
		document.getElementById('submit').disabled = true;
	}
}-->
	</script>

</body>
</html>