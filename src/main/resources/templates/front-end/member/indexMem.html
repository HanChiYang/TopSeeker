<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>會員專區</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous">
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f8f9fa; /* 背景顏色 */
        color: #333; /* 文字顏色 */
        padding-top: 20px;
    }

    .container {
        max-width: 800px;
        margin: auto;
    }

    h1 {
        font-size: 2.5rem;
        margin-bottom: 1.5rem;
        text-align: center;
    }

    #blob_holder, #previewAndUpload {
        display: flex;
        align-items: center;
    }

    #blob_holder {
        margin-bottom: 20px;
    }

    #blob_holder img {
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-right: 20px; /* 調整原大頭照向左移動 */
    }

    #updatePicBtn {
        cursor: pointer;
    }

    #previewAndUpload {
        margin-top: 20px;
    }

    #previewAndUpload img {
        border-radius: 50%;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        margin-right: 20px; /* 調整預覽圖片向右移動 */
    }

    #previewButtons {
        display: flex;
        align-items: center;
    }

    button[type="submit"] {
        margin-top: 10px;
    }

    /* Responsive adjustments */
    @media (max-width: 576px) {
        h1 {
            font-size: 2rem;
        }

        #blob_holder img {
            width: 80px;
            height: 80px;
        }

        #previewAndUpload img {
            width: 80px;
            height: 80px;
        }
    }
</style>
</head>
<body>

<nav th:insert="~{/front-end/navbar.html}"></nav>

<div class="container mt-4">
    <h1>會員專區</h1>

    <div id="blob_holder">
        <img th:src="@{/member/DBGifReader} + '?memNo=' + ${session.loggedInMember.memNo}"
            width="100px">
    </div>

    <div class="mb-4">
        <input type="file" id="fileInput" name="memImg" accept="image/*" style="display: none;">
        <button id="updatePicBtn" class="btn btn-primary">修改大頭貼</button>
        <button id="cancelUploadBtn" class="btn btn-secondary" style="display: none;">取消</button>
    </div>

    <div id="previewAndUpload" style="display: none;">
        <div>
            <img id="previewImg" width="100px">
        </div>
        <div id="previewButtons">
            <button type="button" id="confirmUploadBtn" class="btn btn-success">確認上傳</button>
        </div>
    </div>

    <p th:if="${session.loggedInMember != null}">
        您好， <span th:text="${session.loggedInMember.memName}"></span>！
    </p>

    <div th:if="${session.loggedInMember.memStatus == 1}" class="mb-4">
        <p>您的信箱尚未驗證</p>
        <form th:action="@{/member/verifyPage}" method="post">
            <button type="submit" class="btn btn-primary">驗證信箱</button>
        </form>
    </div>

    <div class="mb-4">
        <form th:action="@{/member/inspect}" method="post">
            <button type="submit" class="btn btn-info">檢視會員資料</button>
        </form>
    </div>

    <div>
        <form th:action="@{/member/updatePasswordPage}" method="post">
            <button type="submit" class="btn btn-warning">修改密碼</button>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $("#updatePicBtn").on("click", function() {
        $("#fileInput").trigger("click"); // Trigger file input selection
        $("#updatePicBtn").hide();
        $("#cancelUploadBtn").show();
    });

    $("#cancelUploadBtn").on("click", function() {
        $("#fileInput").val(""); // Clear file input
        $("#previewAndUpload").hide(); // Hide preview and upload section
        $("#updatePicBtn").show();
        $("#cancelUploadBtn").hide();
    });

    $("#fileInput").change(function() {
        var file = this.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                $("#previewImg").attr("src", e.target.result);
                $("#previewAndUpload").show();
            };
            reader.readAsDataURL(file);
        }
    });

    $("#confirmUploadBtn").on("click", function() {
        var formData = new FormData();
        formData.append("memImg", $("#fileInput")[0].files[0]);

        $.ajax({
            url: "/member/updatePic",
            type: "POST",
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                alert("大頭貼修改成功");
                $("#previewAndUpload").hide(); // Hide after successful upload
                $("#updatePicBtn").show();
                $("#cancelUploadBtn").hide();
                location.reload(); // Reload the page
            },
            error: function() {
                alert("未選擇圖片");
            }
        });
    });
});
</script>

</body>
</html>
