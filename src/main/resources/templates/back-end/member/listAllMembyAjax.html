<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>查詢會員資料</title>


<link rel="stylesheet" href="//cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css" /> <!-- ●●css for jquery datatables 用 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
h1 {
    margin-top: 25px;
    text-align: center;
}

body {
    padding-top: 0;
}

#example_wrapper { 
    margin: 0 auto; /* 將表格置中 */
    width: 90%;
}

#example_wrapper th, #example_wrapper td {
    text-align: center;
}

#example > tbody > tr > td:nth-child(8),
#example > tbody > tr > td.dt-type-numeric.sorting_1,
#example > tbody > tr > td:nth-child(4),
#example > tbody > tr > td.dt-type-date,
#example > tbody > tr > td:nth-child(7) {
    text-align: center;
}

#loading {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: white; /* 設置為白色背景 */
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 1; /* 確保沒有透明度 */
}

#loading img {
    width: 100px; /* 設定GIF動畫的大小 */
}


</style>
</head>
<body>
<!-- <div id="loading"> -->
<!--     <img src="/images/loading.gif" alt="Loading..."> 替換為你的GIF URL -->
<!-- </div> -->

<!-- <nav th:insert="~{/back-end/back_end_navbar.html}"></nav> -->

<h1>查詢會員資料</h1>

<div id="form">
		<form method="post" id="searchForm" th:action="@{/member/ajaxSearch}">
			<br>
	
			<h4>
				姓名 <input type="text" name="memName" class="form-control"> <br>
				
				
				<input type="submit" value="送出" class="btn btn-lg btn-primary w-100">
	
			</h4>
		</form>
</div>

<div id="resultsBlock">
    <!-- 查询结果将显示在这里 -->
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
<script>
$(document).ready(function() {
    // DataTable 初始化
    function initDataTable() {
        $('#example').DataTable({
            "lengthMenu": [10, 20, 50],
            "searching": false,
            "paging": true,
            "ordering": true,
            "language": {
                "processing": "處理中...",
                "loadingRecords": "載入中...",
                "lengthMenu": "顯示 _MENU_ 筆結果",
                "zeroRecords": "沒有符合的結果",
                "info": "顯示第 _START_ 至 _END_ 筆結果，共<font color=red> _TOTAL_ </font>筆",
                "infoEmpty": "顯示第 0 至 0 筆結果，共 0 筆",
                "infoFiltered": "(從 _MAX_ 筆結果中過濾)",
                "search": "搜尋:",
                "paginate": {
                    "first": "第一頁",
                    "previous": "上一頁",
                    "next": "下一頁",
                    "last": "最後一頁"
                },
                "aria": {
                    "sortAscending":  ": 升冪排列",
                    "sortDescending": ": 降冪排列"
                }
            }
        });
    }

    // 提交表单并处理 AJAX 响应
    $('#searchForm').on('submit', function(event) {
        event.preventDefault();
        
        var formData = $(this).serialize(); // 序列化表单数据
        
        $.ajax({
            url: '/member/ajaxSearch',
            method: 'POST',
            data: formData,
            success: function(response) {
                $('#resultsBlock').html(response);
                initDataTable(); // 在加载新内容后初始化 DataTable
            },
            error: function(error) {
                console.error("Error fetching data:", error);
            }
        });
    });
    
    
    
    $(document).on('click', '.detailsButton', function(event) {
    	
        event.preventDefault();
//         var memNo = $('#memNoInput').val();
        var memNo = $(this).data('memno');
		console.log(memNo)
        
        $.ajax({
            url: '/member/ajaxDetail',
            method: 'POST',
            data: { memNo: memNo },
            success: function(response) {
                console.log(response);
                $('#resultsBlock').html(response);
            },
            error: function(error) {
                console.error("Error fetching detail:", error);
            }
        });
    });
});
</script>
</body>
</html>